package templates

import "fmt"

type SessionInfo struct {
	ID        int64
	Title     string
	CreatedAt string
	UpdatedAt string
	Status    string
	ModeCount int
}

templ SessionsSidebar(sessions []SessionInfo, currentSessionID int64) {
	<aside class="w-full lg:w-80 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 lg:sticky lg:top-12">
		<!-- Sessions Header -->
		<div class="flex items-center justify-between mb-6">
			<h3 class="text-lg font-semibold text-gray-900 dark:text-white">📋 Sessions</h3>
			<button
				class="px-3 py-1 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 dark:hover:bg-indigo-800 transition-colors"
				hx-get="/api/review/sessions/new"
				hx-target="#session-detail"
				hx-swap="innerHTML"
				aria-label="Create new session">
				+ New
			</button>
		</div>

		<!-- Session Search -->
		<div class="mb-4">
			<input
				type="text"
				placeholder="Search sessions..."
				class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 text-sm"
				hx-get="/api/review/sessions/search"
				hx-target="#sessions-list"
				hx-swap="innerHTML"
				hx-trigger="input changed delay:300ms"
				name="query"
				aria-label="Search sessions" />
		</div>

		<!-- Sessions List -->
		<div
			id="sessions-list"
			class="space-y-2 max-h-96 overflow-y-auto"
			hx-get="/api/review/sessions/list"
			hx-trigger="load"
			hx-swap="innerHTML">
			<!-- Sessions will be loaded here via HTMX -->
			if len(sessions) == 0 {
				<div class="p-4 text-center text-gray-500 dark:text-gray-400 text-sm">
					<p>No sessions yet</p>
					<p class="text-xs mt-1">Create a new session to get started</p>
				</div>
			} else {
				for _, session := range sessions {
					<div
						class={ "p-3 rounded-lg border cursor-pointer transition-all", templ.KV("border-indigo-400 bg-indigo-50 dark:bg-indigo-900 dark:border-indigo-600", session.ID == currentSessionID), templ.KV("border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600", session.ID != currentSessionID) }
						hx-get={ fmt.Sprintf("/api/review/sessions/%d", session.ID) }
						hx-target="#session-detail"
						hx-swap="innerHTML"
						aria-label={ fmt.Sprintf("Session: %s", session.Title) }
						role="button"
						tabindex="0">
						<div class="flex items-start justify-between">
							<div class="flex-1 min-w-0">
								<h4 class={ "text-sm font-medium truncate", templ.KV("text-indigo-900 dark:text-indigo-200", session.ID == currentSessionID), templ.KV("text-gray-900 dark:text-white", session.ID != currentSessionID) }>
									{ session.Title }
								</h4>
								<p class={ "text-xs truncate", templ.KV("text-indigo-700 dark:text-indigo-300", session.ID == currentSessionID), templ.KV("text-gray-600 dark:text-gray-400", session.ID != currentSessionID) }>
									{ session.CreatedAt }
								</p>
							</div>
							<span class={ "px-2 py-1 rounded text-xs font-medium whitespace-nowrap ml-2", templ.KV("bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200", session.Status == "active"), templ.KV("bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200", session.Status != "active") }>
								{ session.Status }
							</span>
						</div>
						<div class="mt-2 flex items-center justify-between">
							<span class="text-xs text-gray-500 dark:text-gray-400">
								{ fmt.Sprintf("%d modes", session.ModeCount) }
							</span>
							<button
								class="text-xs text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"
								hx-delete={ fmt.Sprintf("/api/review/sessions/%d", session.ID) }
								hx-target="#session-detail"
								hx-swap="innerHTML"
								hx-confirm="Delete this session? This cannot be undone."
								aria-label="Delete session">
								🗑️
							</button>
						</div>
					</div>
				}
			}
		</div>

		<!-- Sessions Statistics -->
		<div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
			<h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Statistics</h4>
			<div class="space-y-2 text-sm">
				<div class="flex justify-between">
					<span class="text-gray-600 dark:text-gray-400">Total Sessions</span>
					<span class="font-medium text-gray-900 dark:text-white">{ fmt.Sprintf("%d", len(sessions)) }</span>
				</div>
				<div class="flex justify-between">
					<span class="text-gray-600 dark:text-gray-400">Active</span>
					<span class="font-medium text-green-600 dark:text-green-400">
						{
							templ.Raw(func() string {
								count := 0
								for _, s := range sessions {
									if s.Status == "active" {
										count++
									}
								}
								return fmt.Sprintf("%d", count)
							}())
						}
					</span>
				</div>
			</div>
		</div>
	</aside>
}

templ SessionListItem(session SessionInfo, isActive bool) {
	<div
		class={ "p-3 rounded-lg border cursor-pointer transition-all", templ.KV("border-indigo-400 bg-indigo-50 dark:bg-indigo-900 dark:border-indigo-600", isActive), templ.KV("border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600", !isActive) }
		hx-get={ fmt.Sprintf("/api/review/sessions/%d", session.ID) }
		hx-target="#session-detail"
		hx-swap="innerHTML"
		aria-label={ fmt.Sprintf("Session: %s", session.Title) }
		role="button"
		tabindex="0">
		<div class="flex items-start justify-between">
			<div class="flex-1 min-w-0">
				<h4 class={ "text-sm font-medium truncate", templ.KV("text-indigo-900 dark:text-indigo-200", isActive), templ.KV("text-gray-900 dark:text-white", !isActive) }>
					{ session.Title }
				</h4>
				<p class={ "text-xs truncate", templ.KV("text-indigo-700 dark:text-indigo-300", isActive), templ.KV("text-gray-600 dark:text-gray-400", !isActive) }>
					{ session.CreatedAt }
				</p>
			</div>
			<span class={ "px-2 py-1 rounded text-xs font-medium whitespace-nowrap ml-2", templ.KV("bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200", session.Status == "active"), templ.KV("bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200", session.Status != "active") }>
				{ session.Status }
			</span>
		</div>
		<div class="mt-2 flex items-center justify-between">
			<span class="text-xs text-gray-500 dark:text-gray-400">
				{ fmt.Sprintf("%d modes", session.ModeCount) }
			</span>
			<button
				class="text-xs text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"
				hx-delete={ fmt.Sprintf("/api/review/sessions/%d", session.ID) }
				hx-target="#session-detail"
				hx-swap="innerHTML"
				hx-confirm="Delete this session? This cannot be undone."
				aria-label="Delete session">
				🗑️
			</button>
		</div>
	</div>
}

templ SessionDetailView(session SessionInfo) {
	<div id="session-detail" class="w-full lg:flex-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
		<!-- Detail Header -->
		<div class="flex items-start justify-between mb-6 pb-6 border-b border-gray-200 dark:border-gray-700">
			<div class="flex-1">
				<h2 class="text-2xl font-bold text-gray-900 dark:text-white">{ session.Title }</h2>
				<div class="mt-2 flex items-center gap-4">
					<span class={ "px-3 py-1 rounded-lg text-sm font-medium", templ.KV("bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200", session.Status == "active"), templ.KV("bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200", session.Status != "active") }>
						{ session.Status }
					</span>
					<span class="text-sm text-gray-600 dark:text-gray-400">
						Created: { session.CreatedAt }
					</span>
				</div>
			</div>
			<button
				class="px-4 py-2 rounded-lg font-medium bg-red-600 text-white hover:bg-red-700 dark:hover:bg-red-800 transition-colors text-sm"
				hx-delete={ fmt.Sprintf("/api/review/sessions/%d", session.ID) }
				hx-confirm="Delete this session? This cannot be undone."
				aria-label="Delete session">
				🗑️ Delete
			</button>
		</div>

		<!-- Statistics Grid -->
		<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
			<div class="p-4 rounded-lg bg-indigo-50 dark:bg-indigo-900 border border-indigo-200 dark:border-indigo-700">
				<div class="text-sm font-medium text-indigo-600 dark:text-indigo-300">Reading Modes Used</div>
				<div class="mt-2 text-2xl font-bold text-indigo-900 dark:text-indigo-100">{ fmt.Sprintf("%d", session.ModeCount) }</div>
			</div>
			<div class="p-4 rounded-lg bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700">
				<div class="text-sm font-medium text-green-600 dark:text-green-300">Created</div>
				<div class="mt-2 text-sm text-green-900 dark:text-green-100">{ session.CreatedAt }</div>
			</div>
			<div class="p-4 rounded-lg bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700">
				<div class="text-sm font-medium text-blue-600 dark:text-blue-300">Last Updated</div>
				<div class="mt-2 text-sm text-blue-900 dark:text-blue-100">{ session.UpdatedAt }</div>
			</div>
		</div>

		<!-- Session Actions -->
		<div class="space-y-4">
			<h3 class="text-lg font-semibold text-gray-900 dark:text-white">Actions</h3>
			<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
				<button
					class="px-4 py-3 rounded-lg font-medium bg-indigo-600 text-white hover:bg-indigo-700 dark:hover:bg-indigo-800 transition-colors text-sm flex items-center justify-center gap-2"
					hx-post={ fmt.Sprintf("/api/review/sessions/%d/resume", session.ID) }
					hx-swap="innerHTML"
					aria-label="Resume this session">
					▶️ Resume Session
				</button>
				<button
					class="px-4 py-3 rounded-lg font-medium bg-gray-600 text-white hover:bg-gray-700 dark:hover:bg-gray-800 transition-colors text-sm flex items-center justify-center gap-2"
					hx-get={ fmt.Sprintf("/api/review/sessions/%d/export", session.ID) }
					aria-label="Export session">
					⬇️ Export Session
				</button>
				<button
					class="px-4 py-3 rounded-lg font-medium bg-purple-600 text-white hover:bg-purple-700 dark:hover:bg-purple-800 transition-colors text-sm flex items-center justify-center gap-2"
					hx-post={ fmt.Sprintf("/api/review/sessions/%d/duplicate", session.ID) }
					hx-swap="innerHTML"
					aria-label="Duplicate session">
					📋 Duplicate Session
				</button>
				<button
					class="px-4 py-3 rounded-lg font-medium border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400 dark:hover:border-gray-500 transition-colors text-sm"
					hx-post={ fmt.Sprintf("/api/review/sessions/%d/archive", session.ID) }
					hx-swap="innerHTML"
					aria-label="Archive session">
					📁 Archive
				</button>
			</div>
		</div>

		<!-- Mode History -->
		<div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
			<h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Mode History</h3>
			<div class="space-y-3">
				<div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">
					<div class="flex items-center justify-between">
						<span class="text-sm font-medium text-gray-900 dark:text-white">👁️ Preview Mode</span>
						<span class="text-xs text-gray-500 dark:text-gray-400">Today, 10:15 AM</span>
					</div>
					<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">Analyzed project structure and tech stack</p>
				</div>
				<div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">
					<div class="flex items-center justify-between">
						<span class="text-sm font-medium text-gray-900 dark:text-white">🔎 Scan Mode</span>
						<span class="text-xs text-gray-500 dark:text-gray-400">Today, 10:20 AM</span>
					</div>
					<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">Searched for error handling patterns</p>
				</div>
				<div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">
					<div class="flex items-center justify-between">
						<span class="text-sm font-medium text-gray-900 dark:text-white">🔬 Critical Mode</span>
						<span class="text-xs text-gray-500 dark:text-gray-400">Today, 10:30 AM</span>
					</div>
					<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">Quality evaluation and improvement suggestions</p>
				</div>
			</div>
		</div>
	</div>
}

templ SessionDetailEmpty() {
	<div id="session-detail" class="w-full lg:flex-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 flex items-center justify-center">
		<div class="text-center">
			<div class="text-5xl mb-4">📋</div>
			<h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">No Session Selected</h3>
			<p class="text-gray-600 dark:text-gray-400 mb-4">Select a session from the list or create a new one to get started</p>
			<button
				class="px-4 py-2 rounded-lg font-medium bg-indigo-600 text-white hover:bg-indigo-700 dark:hover:bg-indigo-800 transition-colors text-sm"
				hx-get="/api/review/sessions/new"
				hx-target="#session-detail"
				hx-swap="innerHTML">
				+ Create New Session
			</button>
		</div>
	</div>
}

templ SessionStatistics(modeCount int, codeLineCount int, analysisTimeMs int) {
	<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
		<div class="p-4 rounded-lg bg-indigo-50 dark:bg-indigo-900 border border-indigo-200 dark:border-indigo-700">
			<div class="text-sm font-medium text-indigo-600 dark:text-indigo-300">Reading Modes</div>
			<div class="mt-2 text-3xl font-bold text-indigo-900 dark:text-indigo-100">{ fmt.Sprintf("%d", modeCount) }</div>
			<p class="mt-1 text-xs text-indigo-700 dark:text-indigo-400">modes used in analysis</p>
		</div>
		<div class="p-4 rounded-lg bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700">
			<div class="text-sm font-medium text-green-600 dark:text-green-300">Code Analyzed</div>
			<div class="mt-2 text-3xl font-bold text-green-900 dark:text-green-100">{ fmt.Sprintf("%d", codeLineCount) }</div>
			<p class="mt-1 text-xs text-green-700 dark:text-green-400">lines of code</p>
		</div>
		<div class="p-4 rounded-lg bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700">
			<div class="text-sm font-medium text-blue-600 dark:text-blue-300">Analysis Time</div>
			<div class="mt-2 text-3xl font-bold text-blue-900 dark:text-blue-100">{ fmt.Sprintf("%dms", analysisTimeMs) }</div>
			<p class="mt-1 text-xs text-blue-700 dark:text-blue-400">total time spent</p>
		</div>
	</div>
}

templ ModeHistoryItem(icon string, modeName string, timestamp string, description string) {
	<div class="p-4 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow">
		<div class="flex items-start justify-between">
			<div class="flex-1">
				<h4 class="text-sm font-medium text-gray-900 dark:text-white">
					{ icon } { modeName }
				</h4>
				<p class="mt-1 text-sm text-gray-600 dark:text-gray-400">{ description }</p>
			</div>
			<span class="text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap ml-2">{ timestamp }</span>
		</div>
	</div>
}

templ SessionMetadata(createdAt string, updatedAt string, fileSize string, codeLanguages string) {
	<div class="grid grid-cols-2 gap-4">
		<div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">
			<div class="text-xs font-medium text-gray-600 dark:text-gray-400">Created</div>
			<div class="mt-1 text-sm font-semibold text-gray-900 dark:text-white">{ createdAt }</div>
		</div>
		<div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">
			<div class="text-xs font-medium text-gray-600 dark:text-gray-400">Last Updated</div>
			<div class="mt-1 text-sm font-semibold text-gray-900 dark:text-white">{ updatedAt }</div>
		</div>
		<div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">
			<div class="text-xs font-medium text-gray-600 dark:text-gray-400">File Size</div>
			<div class="mt-1 text-sm font-semibold text-gray-900 dark:text-white">{ fileSize }</div>
		</div>
		<div class="p-3 rounded-lg bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600">
			<div class="text-xs font-medium text-gray-600 dark:text-gray-400">Languages</div>
			<div class="mt-1 text-sm font-semibold text-gray-900 dark:text-white">{ codeLanguages }</div>
		</div>
	</div>
}
