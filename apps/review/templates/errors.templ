package templates

// ErrorDisplay shows user-friendly error messages with retry capability
templ ErrorDisplay(errorType string, title string, message string, canRetry bool, retryAction string) {
	if errorType == "error" {
		<div class="p-6 rounded-lg border-l-4 mb-4 animate-fade-in bg-red-50 dark:bg-red-900/20 border-red-500" role="alert">
			<div class="flex items-start">
				<div class="flex-shrink-0">
					<svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
					</svg>
				</div>
				<div class="ml-4 flex-1">
					<h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
						{ title }
					</h3>
					<p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
						{ message }
					</p>
					if canRetry {
						<button 
							class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors"
							hx-post={ retryAction }
							hx-swap="outerHTML"
							hx-indicator="#progress-indicator-container">
							Try Again
						</button>
					}
				</div>
			</div>
		</div>
	} else if errorType == "warning" {
		<div class="p-6 rounded-lg border-l-4 mb-4 animate-fade-in bg-yellow-50 dark:bg-yellow-900/20 border-yellow-500" role="alert">
			<div class="flex items-start">
				<div class="flex-shrink-0">
					<svg class="h-6 w-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
					</svg>
				</div>
				<div class="ml-4 flex-1">
					<h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
						{ title }
					</h3>
					<p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
						{ message }
					</p>
					if canRetry {
						<button 
							class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors"
							hx-post={ retryAction }
							hx-swap="outerHTML"
							hx-indicator="#progress-indicator-container">
							Try Again
						</button>
					}
				</div>
			</div>
		</div>
	} else {
		<div class="p-6 rounded-lg border-l-4 mb-4 animate-fade-in bg-blue-50 dark:bg-blue-900/20 border-blue-500" role="alert">
			<div class="flex items-start">
				<div class="flex-shrink-0">
					<svg class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
					</svg>
				</div>
				<div class="ml-4 flex-1">
					<h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
						{ title }
					</h3>
					<p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
						{ message }
					</p>
					if canRetry {
						<button 
							class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors"
							hx-post={ retryAction }
							hx-swap="outerHTML"
							hx-indicator="#progress-indicator-container">
							Try Again
						</button>
					}
				</div>
			</div>
		</div>
	}
}

// AIServiceUnavailable shows when Ollama is unreachable
templ AIServiceUnavailable() {
	@ErrorDisplay(
		"error",
		"AI Service Unavailable",
		"The AI analysis service is currently unavailable. This could be because Ollama is starting up or experiencing issues. Please try again in a moment.",
		true,
		"/api/review/retry",
	)
}

// AITimeout shows when analysis takes too long
templ AITimeout() {
	@ErrorDisplay(
		"warning",
		"Analysis Timeout",
		"The analysis is taking longer than expected. This might be due to high load or a complex codebase. Please try again with a smaller code sample.",
		true,
		"/api/review/retry",
	)
}

// CircuitOpen shows when circuit breaker is protecting the system
templ CircuitOpen() {
	@ErrorDisplay(
		"warning",
		"Service Temporarily Unavailable",
		"Our AI service is experiencing issues. The system has temporarily disabled AI calls to prevent further problems. Normal service will resume automatically in about a minute.",
		false,
		"",
	)
}

// InvalidInput shows when user input is malformed
templ InvalidInput(field string, reason string) {
	<div class="p-6 rounded-lg border-l-4 mb-4 animate-fade-in bg-red-50 dark:bg-red-900/20 border-red-500" role="alert">
		<div class="flex items-start">
			<div class="flex-shrink-0">
				<svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
				</svg>
			</div>
			<div class="ml-4 flex-1">
				<h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
					Invalid Input
				</h3>
				<p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
					The { field } you provided { reason }. Please check your input and try again.
				</p>
			</div>
		</div>
	</div>
}

// RateLimitExceeded shows when user has made too many requests
templ RateLimitExceeded() {
	@ErrorDisplay(
		"warning",
		"Rate Limit Exceeded",
		"You've made too many requests in a short period. Please wait a moment before trying again.",
		false,
		"",
	)
}
